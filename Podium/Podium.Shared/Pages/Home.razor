@page "/"
@using Podium.Shared.Services.State
@using Podium.Shared.Services.Api
@using Podium.Shared.Models
@inject AuthStateService AuthState
@inject NavigationManager Navigation
@inject IPodiumApiClient ApiClient

<PageTitle>Podium - Predict & Win</PageTitle>

<div class="home-container">
    @if (AuthState.IsAuthenticated)
    {
        <div class="welcome-section">
            <h1>Welcome back, @AuthState.Username!</h1>
            <p>Ready to make your predictions?</p>
        </div>

        @if (favoriteSeasons.Count > 0)
        {
            <div class="favorites-section">
                <h2>
                    <span class="card-icon">⭐</span> Your Favorite Seasons
                </h2>
                <div class="favorites-quick-links">
                    @foreach (var favorite in favoriteSeasons)
                    {
                        <div class="favorite-link" @onclick="() => NavigateToSeason(favorite.SeasonId)">
                            <h4>@favorite.SeriesName</h4>
                            <p>@favorite.SeasonName (@favorite.Year)</p>
                        </div>
                    }
                </div>
            </div>
        }

        <div class="quick-actions">
            <a href="/disciplines" class="action-card">
                <h3><span class="card-icon">🏆</span> Make Predictions</h3>
                <p>Choose a discipline and predict the podium</p>
            </a>

            <a href="/my-predictions" class="action-card">
                <h3><span class="card-icon">📊</span> My Predictions</h3>
                <p>View your predictions and results</p>
            </a>

            <a href="/leaderboard" class="action-card">
                <h3><span class="card-icon">🏅</span> Leaderboard</h3>
                <p>See how you rank against others</p>
            </a>
        </div>
    }
    else
    {
        <div class="hero-section">
            <h1>Predict the Podium</h1>
            <p class="lead">Compete with friends. Predict race winners. Climb the leaderboard.</p>
            
            <div class="cta-buttons">
                <a href="/signup" class="btn btn-primary btn-lg">Get Started</a>
                <a href="/signin" class="btn btn-outline btn-lg">Sign In</a>
            </div>
        </div>

        <div class="features">
            <div class="feature-card">
                <h3><span class="card-icon">🏁</span> Multiple Disciplines</h3>
                <p>From Formula 1 to other motorsports and beyond</p>
            </div>

            <div class="feature-card">
                <h3><span class="card-icon">🎯</span> Simple Predictions</h3>
                <p>Just pick your top 3 for each event</p>
            </div>

            <div class="feature-card">
                <h3><span class="card-icon">🏆</span> Compete & Win</h3>
                <p>Earn points and climb the leaderboard</p>
            </div>
        </div>
    }
</div>

@code {
    private List<FavoriteSeason> favoriteSeasons = new();

    protected override async Task OnInitializedAsync()
    {
        AuthState.OnAuthStateChanged += StateHasChanged;

        if (AuthState.IsAuthenticated)
        {
            await LoadFavoriteSeasons();
        }
    }

    private async Task LoadFavoriteSeasons()
    {
        try
        {
            var response = await ApiClient.GetFavoriteSeasonsAsync();
            if (response.Success && response.Data != null)
            {
                favoriteSeasons = response.Data;
            }
        }
        catch
        {
            // Silently fail - favorites are optional
        }
    }

    private void NavigateToSeason(string seasonId)
    {
        // Navigate to events page for the season
        Navigation.NavigateTo($"/season/{seasonId}/events");
    }

    public void Dispose()
    {
        AuthState.OnAuthStateChanged -= StateHasChanged;
    }
}

