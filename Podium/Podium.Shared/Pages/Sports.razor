@page "/sports"
@using Podium.Shared.Services.Api
@using Podium.Shared.Services.State
@using Podium.Shared.Models
@inject IPodiumApiClient ApiClient
@inject AuthStateService AuthState
@inject NavigationManager Navigation

<PageTitle>Select Sport - Podium</PageTitle>

<div class="page-container">
    <h1>Choose a Sport</h1>

    @if (!AuthState.IsAuthenticated)
    {
        <div class="alert alert-warning">
            Please <a href="/signin">sign in</a> to make predictions.
        </div>
    }

    @if (isLoading)
    {
        <div class="loading-spinner">
            <p>Loading sports...</p>
        </div>
    }
    else if (!string.IsNullOrEmpty(errorMessage))
    {
        <div class="alert alert-danger">@errorMessage</div>
    }
    else if (sports.Count == 0)
    {
        <div class="alert alert-info">
            No sports available at the moment. Check back later!
        </div>
    }
    else
    {
        <div class="sport-grid">
            @foreach (var sport in sports)
            {
                <div class="sport-card" @onclick="() => SelectSport(sport.Id)">
                    <h3>@sport.DisplayName</h3>
                    <p>View competitions ?</p>
                </div>
            }
        </div>
    }
</div>

@code {
    private List<Sport> sports = new();
    private bool isLoading = true;
    private string? errorMessage;

    protected override async Task OnInitializedAsync()
    {
        await LoadSports();
    }

    private async Task LoadSports()
    {
        isLoading = true;
        errorMessage = null;

        try
        {
            var response = await ApiClient.GetSportsAsync();
            if (response.Success && response.Data != null)
            {
                sports = response.Data;
            }
            else
            {
                errorMessage = response.Error ?? "Failed to load sports.";
            }
        }
        catch (Exception ex)
        {
            errorMessage = $"Error: {ex.Message}";
        }
        finally
        {
            isLoading = false;
        }
    }

    private void SelectSport(string sportId)
    {
        Navigation.NavigateTo($"/sports/{sportId}/tiers");
    }
}
